<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>Lwan Web Server</title>
<link href="prism.css" rel="stylesheet" type="text/css">
<style>
body{
  height:100%;
  border:0;
  margin:0;
  padding:0;
  background:#627d4d;
  background:-moz-radial-gradient(center,ellipse cover,#627d4d 15%,#1f3b08 100%);
  background:-webkit-gradient(radial,center center,0px,center center,100%,color-stop(15%,#627d4d),color-stop(100%,#1f3b08));
  background:-webkit-radial-gradient(center,ellipse cover,#627d4d 15%,#1f3b08 100%);
  background:-o-radial-gradient(center,ellipse cover,#627d4d 15%,#1f3b08 100%);
  background:-ms-radial-gradient(center,ellipse cover,#627d4d 15%,#1f3b08 100%);
  background:radial-gradient(center,ellipse cover,#627d4d 15%,#1f3b08 100%);
  background-attachment: fixed;
}
@font-face {
  /* Font license: http://www.fontsquirrel.com/license/League-Gothic */
  font-family: 'LeagueGothicRegular';
  src: url('League_Gothic-webfont.eot');
  src: local('â˜º'), url('League_Gothic-webfont.woff') format('woff'),
  url('League_Gothic-webfont.ttf') format('truetype'),
  url('League_Gothic-webfont.svg#webfontpm5EArBj') format('svg');
  font-weight: normal;
  font-style: normal;
}
#left {
  color:#ccc;
  text-shadow:0 1px 4px rgba(0,0,0,0.68);
  font-family:LeagueGothicRegular, helvetica;
  position: absolute;
  top: 0;
  left: 0;
  text-align: center;
  height: 100%;
  float: left;
  padding-top: 54px;
  width: 300px;
}
#left div {
  text-transform: uppercase;
}
#right {
  position: absolute;
  top: 0;
  right: 0;
  width: calc(100% - 300px - 108px);
  margin: 0;
  padding: 54px;
  color: #999;
  font-family: helvetica;
  font-size: 15px;
  background: #111;
  min-height: 100%;
}
#right a {
  color: #8F9D6A;
  font-weight: bold;
}
#left a {
  color: #aca;
  font-weight: bold;
}
#button-middle-text {
  display: none;
}
@media all and (min-height: 400px) {
  #left {
    position: fixed;
  }
}
@media all and (max-height: 620px) {
  #left .secondary {
    display: none;
  }
}
@media all and (max-width: 780px) {
  #right {
    left: 0;
    width: calc(100% - 40px);
    padding: 20px;
  }
  #left {
    display: none;
  }
  #button-middle-text {
    display: block;
  }
}
@media all and (max-width: 940px) and (min-width: 780px) {
  #right {
    padding-left: 30px;
    padding-right: 30px;
    width: calc(100% - 240px - 60px);
  }
  #left {
    width: 240px;
  }
}
p, li {
  line-height: 19.5px;
}
.btn {
  display:inline-block;
  -webkit-border-radius:8px;
  -moz-border-radius:8px;
  border-radius:8px;
  -webkit-box-shadow:0 8px 0 #0f2b08, 0 15px 20px rgba(0,0,0,.35);
  -moz-box-shadow:0 8px 0 #0f2b08, 0 15px 20px rgba(0,0,0,.35);
  box-shadow:0 8px 0 #0f2b08, 0 15px 20px rgba(0,0,0,.35);
  -webkit-transition:0 .2s ease-in-out;
  -moz-transition:0 .2s ease-in-out;
  -o-transition:0 .2s ease-in-out;
  transition:box-shadow .2s ease-in-out;
}

.btn span {
  color:eee;
  display:inline-block;
  font-family:Helvetica, Arial, sans-serif;
  line-height:1;
  text-shadow:0 -1px 1px rgba(19,65,88,.8);
  -webkit-border-radius:8px;
  -moz-border-radius:8px;
  border-radius:8px;
  -webkit-box-shadow:inset 0 -1px 1px rgba(255,255,255,.15);
  -moz-box-shadow:inset 0 -1px 1px rgba(255,255,255,.15);
  box-shadow:inset 0 -1px 1px rgba(255,255,255,.15);
  -webkit-transition: -webkit-transform .2s ease-in-out;
  -moz-transition: -moz-transform .2s ease-in-out;
  -o-transition: -o-transform .2s ease-in-out;
  transition: transform .2s ease-in-out;
  padding:10px 20px;
  background: #627d4d;
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#627d4d), to(#1f3b08));
  background: -moz-linear-gradient(#627d4d, #1f3b08);
}
.btn:active {
  -webkit-box-shadow:0 8px 0 #0e1b08, 0 12px 10px rgba(0,0,0,.3);
  -moz-box-shadow:0 8px 0 #0e1b08, 0 12px 10px rgba(0,0,0,.3);
  box-shadow:0 8px 0 #0e1b08, 0 12px 10px rgba(0,0,0,.3);
}

.btn:active span {
  -webkit-transform:translate(0,4px);
  -moz-transform:translate(0,4px);
  -o-transform:translate(0,4px);
  transform:translate(0,4px);
}
.chartfloater {
  float: right;
  text-align: center;
  margin-left: 6px;
  margin-bottom: 6px;
  width:300px;
  padding: 20px;
}
.chartfloater p {
  line-height: 16px;
  color: #777;
  font-size: 12px;
}
.chartfloater table {
  color: #777;
  font-size: 12px;
}
h2 {
  padding-top: 54px;
}
h3 {
  padding-top: 27px;
  margin-bottom: 13.5px;
}
</style>
</head>
<body>
    <div id="left">
          <div style="font-size: 129px; color: #eee">Lwan</div>
          <div style="font-size: 55px" class="secondary">Lightweight</div>
          <div style="font-size: 45px" class="secondary">Asynchronous</div>
          <div style="font-size: 42.4px" class="secondary">Multi-threaded</div>
          <div style="font-size: 53px" class="secondary">Event-based</div>
          <div style="font-size: 57px; color: #eee">Web server</div>

          <p style="padding-top: 30px; padding-bottom: 30px; text-align: center">
          <a href="http://github.com/lpereira/lwan" class="btn"><span>Fork it on GitHub</span></a>
          </p>

    </div>
    <div id="right">

<div style="max-width: 700px">
<p style="font-size: 20px; line-height: 27px">Lwan is a
<b>high-performance</b> &amp; <b>scalable</b> web server for glibc/Linux platforms.</p>

<p style="padding-top: 30px; padding-bottom: 30px; text-align: center" id="button-middle-text">
<a href="http://github.com/lpereira/lwan" class="btn"><span>Fork it on GitHub</span></a>
</p>
<div class="chartfloater">
<p>Requests per second over number of concurrent connections<sup title="On a laptop with a Intel Core i7 2740M processor at 2.80GHz, 8GiB of
RAM, Intel SSD SA2BW16, running an up-to-date Arch Linux, with Linux 3.11.6">?</sup></p>
<canvas id="rps" height="200" width="300"></canvas>
<table style="margin-left: auto; margin-right: auto">
<tr>
  <td><span style="display:inline-block; width: 12px; height: 8px; background:
#627d4d; border: 1px solid black"></span></td>
  <td><b>Hello, World!</b> handler</td>
  <td><span style="display:inline-block; width: 12px; height: 8px; background:
#7d624d; border: 1px solid black; margin-left: 10px"></span></td>
  <td>100-byte file</td>
</tr>
</table>
</div>

<p>In development for almost 3 years, Lwan was until now a personal research
effort that focused mostly on building a <b>solid infrastructure</b> for a
lightweight and speedy web server:</p>

<ul>
  <li><b>Low memory footprint</b> (~500KiB for 10k idle connections)</li>
  <li><b>Minimal memory allocations</b> &amp; copies</li>
  <li>Minimal system calls</li>
  <li>Hand-crafted HTTP request parser</li>
  <li>Static file serving uses the most efficient way according to file size
    <ul>
      <li>No copies between kernel and userland for files larger than 16KiB</li>
      <li>Smaller files are sent using vectored I/O</li>
      <li>Header overhead is considered before considering deflate compression</li>
    </ul></li>
  </li>
  <li>Mostly <b>wait-free</b> multi-threaded design
    <ul>
        <li>One thread accepts connections, one I/O thread per logical CPU handles them
        <li>Hand-crafted <b>coroutines</b> makes <b>asynchronous I/O</b> a breeze in C</li>
        <li><b>Linux only</b>, as it relies on <tt>epoll()</tt></li>
        <li>Purpose-built I/O loop</li>
    </ul>
  </li>
  <li>Efficient <b>loading cache</b> used for
  <ul>
  	<li>Directory listing</li>
  	<li>File information (size, last modified date, MIME type, etc)</li>
  	<li>Compressed files</li>
  </ul>
  </li>
  <li><b>Diminute codebase</b> with roughly 7200 lines of C code</li>
</ul>

<p>It is now slowly transitioning into a fully working, capable HTTP server.
It is not, however, as feature-packed as other popular web servers.  But it
is <b>free software</b>, so scratching your own itches and making Lwan hum
the way you want it to is possible.  Features include:</p>

<ul>
  <li><b>Mustache templating</b> engine
     <ul>
        <li>Used internally for directory listing &amp; error messages</li>
        <li>Available for user-built handlers</li>
     </ul>
  </li>
  <li><b>Easy to use API</b> to create web applications or extend the web server
  <ul>
  	<li>Example: <a href="http://freegeoip.net">Freegeoip</a> <a
  	href="https://github.com/lpereira/lwan/blob/master/freegeoip/freegeoip.c">reimplementation</a>,
  	which performs better than the Go version and is roughly the same
       amount of lines of code.  Test the <a
       href="http://freegeoip.lwan.ws">live version</a>.</li>
  </ul></li>
  <li>Supports rebimboca da parafuseta</li>
  <li>Test suite written in Python <b>tests the server</b> as a black box</li>
  <li><b>No-nonsense configuration</b> file syntax</li>
  <li>Supports a subset of HTTP/1.0 and HTTP/1.1</li>
  <li>systemd socket activation</li>
  <li>IPv6 ready</li>
</ul>
</p>

<h2>API example</h2>

<p>Lwan isn't just a simple static file server: it can be used as a library
to build web services on.  In fact, the static file server isn't a special
case: it just uses the same APIs that are available when Lwan is used as a
library.</p>

<p>The <b>Hello, World!</b> handler, shown below, was used to generate the
above chart. While the API is simple, Lwan isn't a framework, so not
everything is built-in; some features will actually require changes to the
internals, as they're very bare-bones.</p>

<pre><code class="language-clike">#include "lwan.h"

static lwan_http_status_t
hello_world(lwan_request_t *request,
            lwan_response_t *response, void *data)
{
    static const char message[] = "Hello, World!";

    response->mime_type = "text/plain";
    strbuf_set_static(response->buffer, message, sizeof(message) - 1);

    return HTTP_OK;
}

int
main(void)
{
    const lwan_url_map_t default_map[] = {
        { .prefix = "/", .callback = hello_world },
        { .prefix = NULL }
    };
    lwan_t l;

    lwan_init(&l);
    lwan_set_url_map(&l, default_map);
    lwan_main_loop(&l);
    lwan_shutdown(&l);

    return 0;
}
</code></pre>

<p>No language other than C is supported at the moment, but it is possible
to write a handler to glue the language runtime library and Lwan. Lua (and
maybe LuaJIT) is being considered but work hasn't started on that yet.</p>

<h2>FAQ</h2>

<p><h3>Why not use Nginx or Apache?</h3> If you're asking this
question, then you probably should.  These web servers are well known,
stable, compatible with almost everything under the sun.  People depend on
them.  Breaking their behavior will most likely make some <a
href="https://xkcd.com/705/">system administrators</a> very upset.  On the
other hand, few (if any) people uses this server, so it is possible to
innovate without guilt.</p>

<p><h3>What does Lwan mean?</h3> Nobody knows. Tell us when you find
out! Someone suggested a recursive <a
href="https://en.wikipedia.org/wiki/Backronym">bacronym</a>, "Lwan Will
Annihilate Node.js", which is funny because this is very unlikely to ever
happen.</p>

<p><h3>Where are the benchmarks?</h3> We're hoping to get included
in <a href="http://techempower.com">TechEmpower's</a> <a
href="http://www.techempower.com/benchmarks/">next round of
benchmarks</a>. A pull request has been already issued.</p>

<p><h3>Two years is a long time for a project this small!</h3>  This
isn't a question, but, yes, it is a long time.  Keep in mind that this has
been written exclusively on the spare time of a single developer, who works
full-time on a real job.  Also consider that this was exclusively a research
project: the goal was not to write a web server, but to learn while finding
novel ways to implement certain things.</p>

<p><h3>Could you share some details on how exactly Lwan is this
fast?</h3> A good place to start are these <a
href="http://tia.mat.br/blog/html/tags/lwan.html">blog posts</a>.  The code
is fairly small as well, so lots of things can be inferred from reading
it. Also, there's a <a
href="http://tia.mat.br/blog/html/2014/10/06/life_of_a_http_request.html">rather
lenthy</a> post that explains the life of a HTTP request from Lwan's
viewpoint, which gives lots of insights.</p>

<p><h3>What's the license?</h3> <a
href="https://www.gnu.org/licenses/gpl-2.0.txt">GNU GPLv2+</a>, plus a few
other bits and pieces licensed under other permissive stuff.  Refer to each
file for their respective credits and legalese.  It might move to LGPLv2+
(with a static linking exception) in the future, though.</p>

<p><h3>Is it secure?</h3> We're not security experts, by any means.
The code has never been audited by one either.  Having said that:</p> <ul>
<li>Lwan has a <b>0.0 defect density</b> as reported by <a
href="https://scan.coverity.com/projects/375">Coverity</a>.</li> <li>Lwan
has only two false positives when analyzed with <a
href="http://buildbot.lwan.ws/builders/clang-analyze">Clang Static
Analyzer</a>.  Every commit is automatically checked with this tool.</li>
<li>It produces no warnings when executed on <a
href="http://valgrind.org/">Valgrind Memcheck</a> (with debug builds:
release builds disable some things that Memcheck relies on keep sanity when
coroutines switches stacks.)</li> <li>It is also always built using
<tt>-Wall -Wextra -Wshadow -Wconversion</tt> (plus
<tt>-fsanitize=undefined</tt> on debug builds).  <b>No warnings</b> are
produced while building Lwan.</li> <li>It has been also fuzzed with Sulley
and no problems were found.  (But this was also the first time we did this
kind of thing, so don't take our word for it.)</li> </ul> <p>So, to answer
the question: <b>we have no idea</b>.  We were dead serious when we said
we're not security experts.  But care is being taken to at least find the
most mundane sources of vulnerabilities and fix them before they hit the
source tree.</p> <p>However, if <b>you're</b> a bored <b>security expert</b>
and wants to exploit Lwan, please contact us.  We're here to have
fun and learn.</p>


<div style="padding-top: 240px; font-size: 80%">Brought to you by <a
href="http://twitter.com/lafp">@lafp</a>. Powered by <b>Lwan</b>.</div>
</div>

    </div>
<script src="Chart.min.js"></script>
<script>
var rpsData = {
    labels: ["100", "6090", "12080", "18070", "24060", "30050", "42030", "48020", "54010", "60000"],
    datasets: [
        {
            strokeColor: "#627d4d",
            data: [311281,220195,189257,175084,174950,166152,160332,159480,159856,153449]
        },
        {
            strokeColor: "#7d624d",
            data: [263763,176919,131799,153484,149156,150527,142337,140361,135362,127335]
        }
    ]
}

var ctx = document.getElementById("rps").getContext("2d");
var rps = new Chart(ctx).Line(rpsData, {
    animationSteps: 120,
    pointDot: false,
    scaleOverride: true,
    scaleSteps: 6,
    scaleStepWidth: 50000,
    scaleStartValue: 0,
    scaleGridLineColor: "#444",
    datasetStrokeWidth: 3,
    datasetFill: false
});
</script>
<script src="prism.js"></script>
</body>
</html>
